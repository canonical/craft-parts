description: A test project that builds both libgit2 and pygit2, but doesn't prime the libgit2 headers.
parts:
  libgit2:
    source: https://github.com/libgit2/libgit2/archive/refs/tags/v1.7.0.tar.gz
    plugin: cmake
    cmake-parameters:
      - -DCMAKE_INSTALL_PREFIX=/usr
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    build-attributes:
      - enable-patchelf
    stage:
      # Ensure that we're not staging the headers in the normal stage directory.
      # Instead, we stage the headers in the backstage directory.
      - -usr/include
  pygit2:
    plugin: python
    after: [libgit2]
    source: .
    python-packages:
      - pygit2==1.13.0
    build-environment:
      # Ensure that we're building pygit2 from source.
      - "PIP_NO_BINARY": ":all:"
      - "PIP_NO_CACHE_DIR": "1"
